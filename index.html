<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å–œå¹¼ å¾®å•†åŸ</title>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        :root { --line-green: #06C755; --bg-gray: #f8f8f8; }
        body { font-family: sans-serif; background: var(--bg-gray); margin: 0; padding: 0; }

        /* --- é ‚éƒ¨æœå°‹æ¬„ --- */
        .header-search {
            position: fixed; top: 0; left: 0; right: 0;
            background: white; padding: 10px 15px;
            z-index: 1000; box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .search-box {
            width: 100%; padding: 8px 15px; border-radius: 20px;
            border: 1px solid #ddd; outline: none; box-sizing: border-box;
        }

        /* --- å…§å®¹å®¹å™¨ (é ‚éƒ¨ç•™ç™½çµ¦æœå°‹æ¬„) --- */
        .main-app { padding-top: 60px; padding-bottom: 120px; } /* åº•éƒ¨ç•™ç™½120pxç¢ºä¿ä¸è¢«è³¼ç‰©è»Šé®ä½ */

        /* --- æ¨è–¦å•†å“å€å¡Š (æ‰‹å‹•åœ–ç‰‡é€£çµ) --- */
        .recommend-area { padding: 10px; }
        .recommend-title { font-weight: bold; margin-bottom: 8px; font-size: 15px; display: block; }
        .recommend-row { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 5px; }
        .recommend-item { 
            min-width: 140px; background: white; border-radius: 8px; 
            overflow: hidden; box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .recommend-item img { width: 100%; height: 100px; object-fit: cover; }
        .recommend-info { padding: 5px; font-size: 12px; text-align: center; }

        /* --- å•†å“æ¸…å–® --- */
        .product-list { padding: 10px; background: white; }
        .product-card {
            display: flex; align-items: center; padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        .product-img { width: 60px; height: 60px; border-radius: 5px; object-fit: cover; }
        .product-info { flex: 1; margin-left: 10px; }
        .product-name { font-size: 14px; font-weight: bold; }
        .product-price { color: #e44d26; font-size: 13px; margin-top: 3px; }

        /* --- åŠ æ¸›æŒ‰éˆ• --- */
        .qty-box { display: flex; align-items: center; }
        .btn-qty { 
            width: 25px; height: 25px; border-radius: 50%; border: 1px solid #ccc;
            background: white; display: flex; align-items: center; justify-content: center;
        }
        .qty-num { margin: 0 8px; font-size: 14px; min-width: 15px; text-align: center; }

        /* --- åˆ†é å™¨ (ç·Šè·Ÿåœ¨å•†å“æ¸…å–®ä¸‹æ–¹) --- */
        .pagination-bar {
            background: white; padding: 15px; 
            display: flex; justify-content: space-between; align-items: center;
            border-top: 1px solid #eee; margin-top: -10px; /* æ¶ˆé™¤èˆ‡æ¸…å–®çš„é–“éš™ */
        }
        .page-info { font-size: 13px; color: #666; }
        .page-btn { padding: 5px 12px; border-radius: 4px; border: 1px solid #ddd; background: #fff; font-size: 12px; }

        /* --- åº•éƒ¨è³¼ç‰©è»ŠæŒ‰éˆ• --- */
        .cart-bar {
            position: fixed; bottom: 25px; left: 15px; right: 15px;
            background: #333; color: white; border-radius: 30px;
            padding: 12px 20px; display: flex; justify-content: space-between;
            align-items: center; box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 2000; display: none;
        }
        .btn-submit { background: var(--line-green); color: white; border: none; padding: 8px 15px; border-radius: 20px; font-weight: bold; }

        .hidden { display: none; }
    </style>
</head>
<body>

    <div id="app" class="main-app">
        <div class="header-search">
            <input type="text" id="searchInput" class="search-box" placeholder="ğŸ” æœå°‹å•†å“..." oninput="doSearch()">
        </div>

        <div class="recommend-area" id="recommendSection">
            <span class="recommend-title">âœ¨ ç²¾é¸æ¨è–¦</span>
            <div class="recommend-row">
                <div class="recommend-item" onclick="quickAdd('æ¨è–¦å•†å“A', 490)">
                    <img src="https://via.placeholder.com/150x100?text=Product+A">
                    <div class="recommend-info">ç²¾é¸å•†å“A<br><b>$490</b></div>
                </div>
                <div class="recommend-item" onclick="quickAdd('æ¨è–¦å•†å“B', 320)">
                    <img src="https://via.placeholder.com/150x100?text=Product+B">
                    <div class="recommend-info">ç²¾é¸å•†å“B<br><b>$320</b></div>
                </div>
            </div>
        </div>

        <div class="product-list" id="productList"></div>

        <div class="pagination-bar" id="pager">
            <button class="page-btn" onclick="changePage(-1)">ä¸Šä¸€é </button>
            <span class="page-info" id="pageDisplay">ç¬¬ 1 é  / å…± 1 é </span>
            <button class="page-btn" onclick="changePage(1)">ä¸‹ä¸€é </button>
        </div>
    </div>

    <div id="cartBar" class="cart-bar" onclick="sendOrder()">
        <div>å·²é¸ <span id="cartCount">0</span> ä»¶ï¼Œå…± $<span id="cartTotal">0</span></div>
        <button class="btn-submit">é€å‡ºè¨‚å–®</button>
    </div>

    <script>
        const GAS_URL = "https://script.google.com/macros/s/AKfycbz0W3uEcL_e8J_OmP4SLwwNMADrv1iqQTe-Ikb0AWlCgNjy2PYg4UPNLcf732RlllOjcw/exec"; //GAS URL
        let allItems = [];
        let displayItems = [];
        let cart = {};
        let page = 1;
        const size = 10;

        async function init() {
            await liff.init({ liffId: "2009084382-z4lJ5Lc6" }); //LIFF ID
            const resp = await fetch(GAS_URL);
            allItems = await resp.json();
            displayItems = allItems;
            render();
        }

        // --- æœå°‹åŠŸèƒ½ ---
        function doSearch() {
            const key = document.getElementById('searchInput').value.toLowerCase();
            displayItems = allItems.filter(i => i.name.toLowerCase().includes(key));
            page = 1;
            render();
            // æœå°‹æ™‚éš±è—æ‰‹å‹•æ¨è–¦å€ï¼Œè®“çµæœæ›´æ¸…æ¥š
            document.getElementById('recommendSection').style.display = key ? 'none' : 'block';
        }

        // --- æ¸²æŸ“ç•«é¢ ---
        function render() {
            const list = document.getElementById('productList');
            const start = (page - 1) * size;
            const currentData = displayItems.slice(start, start + size);

            list.innerHTML = currentData.map(item => {
                const q = cart[item.name] ? cart[item.name].qty : 0;
                return `
                    <div class="product-card">
                        <img class="product-img" src="${item.img || ''}">
                        <div class="product-info">
                            <div class="product-name">${item.name}</div>
                            <div class="product-price">$${item.price}</div>
                        </div>
                        <div class="qty-box">
                            <button class="btn-qty" onclick="updateQty('${item.name}', ${item.price}, -1)">-</button>
                            <span class="qty-num">${q}</span>
                            <button class="btn-qty" onclick="updateQty('${item.name}', ${item.price}, 1)">+</button>
                        </div>
                    </div>
                `;
            }).join('');

            const totalPages = Math.ceil(displayItems.length / size) || 1;
            document.getElementById('pageDisplay').innerText = `ç¬¬ ${page} é  / å…± ${totalPages} é `;
        }

        // --- åˆ†é é‚è¼¯ ---
        function changePage(delta) {
            const totalPages = Math.ceil(displayItems.length / size) || 1;
            let newPage = page + delta;
            if (newPage >= 1 && newPage <= totalPages) {
                page = newPage;
                render();
                window.scrollTo(0,0);
            }
        }

        // --- è³¼ç‰©è»Šé‚è¼¯ ---
        function updateQty(name, price, delta) {
            if (!cart[name]) cart[name] = { price: price, qty: 0 };
            cart[name].qty += delta;
            if (cart[name].qty <= 0) delete cart[name];
            updateUI();
            render();
        }

        function quickAdd(name, price) {
            updateQty(name, price, 1);
            alert("å·²åŠ å…¥è³¼ç‰©è»Š: " + name);
        }

        function updateUI() {
            let count = 0, total = 0;
            for (let k in cart) {
                count += cart[k].qty;
                total += cart[k].qty * cart[k].price;
            }
            const bar = document.getElementById('cartBar');
            bar.style.display = count > 0 ? 'flex' : 'none';
            document.getElementById('cartCount').innerText = count;
            document.getElementById('cartTotal').innerText = total;
        }

        async function sendOrder() {
            if (!confirm("ç¢ºå®šé€å‡ºè¨‚å–®ï¼Ÿ")) return;
            const profile = await liff.getProfile();
            const res = await fetch(GAS_URL, {
                method: 'POST',
                body: JSON.stringify({
                    userId: profile.userId,
                    userName: profile.displayName,
                    cartJson: JSON.stringify(cart)
                })
            });
            alert("è¨‚å–®å·²é€å‡ºï¼");
            cart = {};
            updateUI();
            render();
        }

        init();
    </script>
</body>
</html>
